let opMap;const FontInspector=function(){let d,n=!1;const a="data-font-name";function c(){for(const e of document.querySelectorAll(`span[${a}]`))e.className="debuggerHideText"}function l(e,t){for(const n of document.querySelectorAll(`span[${a}=${e}]`))n.className=t?"debuggerShowText":"debuggerHideText"}function o(e){if(e.target.dataset.fontName&&"SPAN"===e.target.tagName.toUpperCase()){var t=e.target.dataset.fontName;for(const n of document.getElementsByTagName("input"))n.dataset.fontName===t&&(n.checked=!n.checked,l(t,n.checked),n.scrollIntoView())}}return{id:"FontInspector",name:"Font Inspector",panel:null,manager:null,init(e){var t=this.panel,n=document.createElement("button");n.addEventListener("click",c),n.textContent="Refresh",t.append(n),d=document.createElement("div"),t.append(d)},cleanup(){d.textContent=""},enabled:!1,get active(){return n},set active(e){if(n=e)document.body.addEventListener("click",o,!0),c();else{document.body.removeEventListener("click",o,!0);for(const t of document.querySelectorAll(`span[${a}]`))t.className=""}},fontAdded(t,e){var n=function(e,t){var n=document.createElement("table");for(const r of t){var a=document.createElement("tr"),o=document.createElement("td"),o=(o.textContent=r,a.append(o),document.createElement("td"));o.textContent=e[r].toString(),a.append(o),n.append(a)}return n}(t,["name","type"]);const a=t.loadedName;var o=document.createElement("div"),r=document.createElement("span"),s=(r.textContent=a,document.createElement("a")),e=(e?(e=/url\(['"]?([^)"']+)/.exec(e),s.href=e[1]):t.data&&(s.href=URL.createObjectURL(new Blob([t.data],{type:t.mimetype}))),s.textContent="Download",document.createElement("a"));e.href="",e.textContent="Log",e.addEventListener("click",function(e){e.preventDefault(),console.log(t)});const i=document.createElement("input");i.setAttribute("type","checkbox"),i.dataset.fontName=a,i.addEventListener("click",function(){l(a,i.checked)}),o.append(i,r," ",s," ",e,n),d.append(o),setTimeout(()=>{this.active&&c()},2e3)}}}(),StepperManager=function(){let o=[],a=null,r=null,s=null,i=Object.create(null);return{id:"Stepper",name:"Stepper",panel:null,manager:null,init(e){const t=this;r=document.createElement("div"),(s=document.createElement("select")).addEventListener("change",function(e){t.selectStepper(this.value)}),r.append(s),a=document.createElement("div"),this.panel.append(r,a),sessionStorage.getItem("pdfjsBreakPoints")&&(i=JSON.parse(sessionStorage.getItem("pdfjsBreakPoints"))),opMap=Object.create(null);for(const n in e.OPS)opMap[e.OPS[n]]=n},cleanup(){s.textContent="",a.textContent="",o=[]},enabled:!1,active:!1,create(e){var t=document.createElement("div"),n=(t.id="stepper"+e,t.hidden=!0,t.className="stepper",a.append(t),document.createElement("option")),n=(n.textContent="Page "+(e+1),n.value=e,s.append(n),i[e]||[]),t=new Stepper(t,e,n);return o.push(t),1===o.length&&this.selectStepper(e,!1),t},selectStepper(e,t){e|=0,t&&this.manager.selectPanel(this);for(const n of o)n.panel.hidden=n.pageIndex!==e;for(const a of s.options)a.selected=(0|a.value)===e},saveBreakPoints(e,t){i[e]=t,sessionStorage.setItem("pdfjsBreakPoints",JSON.stringify(i))}}}(),Stepper=function(){function g(e,t){e=document.createElement(e);return t&&(e.textContent=t),e}function v(n){if("string"==typeof n)return n.length<=75?n:n.substring(0,75)+"...";if("object"!=typeof n||null===n)return n;if("length"in n){var a=[];let e,t;for(e=0,t=Math.min(10,n.length);e<t;e++)a.push(v(n[e]));return e<n.length&&a.push("..."),a}var e={};for(const t in n)e[t]=v(n[t]);return e}return class{constructor(e,t,n){this.panel=e,this.breakPoint=0,this.nextBreakPoint=null,this.pageIndex=t,this.breakPoints=n,this.currentIdx=-1,this.operatorListIdx=0,this.indentLevel=0}init(e){var t=this.panel,n=g("div","c=continue, s=step"),a=g("table"),o=(n.append(a),a.cellSpacing=0,g("tr"));a.append(o),o.append(g("th","Break"),g("th","Idx"),g("th","fn"),g("th","args")),t.append(n),this.table=a,this.updateOperatorList(e)}updateOperatorList(n){const t=this;function a(){var e=+this.dataset.idx;this.checked?t.breakPoints.push(e):t.breakPoints.splice(t.breakPoints.indexOf(e),1),StepperManager.saveBreakPoints(t.pageIndex,t.breakPoints)}if(!(15e3<this.operatorListIdx)){var e,o=document.createDocumentFragment(),r=Math.min(15e3,n.fnArray.length);for(let t=this.operatorListIdx;t<r;t++){var s=g("tr"),i=(s.className="line",s.dataset.idx=t,o.append(s),this.breakPoints.includes(t)),d=n.argsArray[t]||[],c=g("td"),l=g("input"),i=(l.type="checkbox",l.className="points",l.checked=i,l.dataset.idx=t,l.onclick=a,c.append(l),s.append(c,g("td",t.toString())),opMap[n.fnArray[t]]);let e=d;if("showText"===i){var p,l=d[0],u=g("tr"),m=g("tr"),h=g("tr");for(const f of l)"object"==typeof f&&null!==f?(u.append(g("td",f.originalCharCode)),m.append(g("td",f.fontChar)),h.append(g("td",f.unicode))):((p=g("td",f)).classList.add("advance"),u.append(p),m.append(g("td")),h.append(g("td")));e=g("td");c=g("table");c.classList.add("showText"),e.append(c),c.append(u,m,h)}else"restore"===i&&0<this.indentLevel&&this.indentLevel--;s.append(g("td"," ".repeat(2*this.indentLevel)+i)),"save"===i&&this.indentLevel++,e instanceof HTMLElement?s.append(e):s.append(g("td",JSON.stringify(v(e))))}r<n.fnArray.length&&((e=g("td","...")).colspan=4,o.append(e)),this.operatorListIdx=n.fnArray.length,this.table.append(o)}}getNextBreakPoint(){this.breakPoints.sort(function(e,t){return e-t});for(const e of this.breakPoints)if(e>this.currentIdx)return e;return null}breakIt(e,t){StepperManager.selectStepper(this.pageIndex,!0),this.currentIdx=e;const n=e=>{switch(e.keyCode){case 83:document.removeEventListener("keydown",n),this.nextBreakPoint=this.currentIdx+1,this.goTo(-1),t();break;case 67:document.removeEventListener("keydown",n),this.nextBreakPoint=this.getNextBreakPoint(),this.goTo(-1),t()}};document.addEventListener("keydown",n),this.goTo(e)}goTo(e){for(const t of this.panel.getElementsByClassName("line"))(0|t.dataset.idx)===e?(t.style.backgroundColor="rgb(251,250,207)",t.scrollIntoView()):t.style.backgroundColor=null}}}(),Stats=function(){let s=[];function i(e){e.textContent=""}return{id:"Stats",name:"Stats",panel:null,manager:null,init(e){},enabled:!1,active:!1,add(e,t){if(t){var n=function(e){for(var[t,n]of s.entries())if(n.pageNumber===e)return t;return!1}(e),n=(!1!==n&&(s[n].div.remove(),s.splice(n,1)),document.createElement("div")),a=(n.className="stats",document.createElement("div")),o=(a.className="title",a.textContent="Page: "+e,document.createElement("div"));o.textContent=t.toString(),n.append(a,o),s.push({pageNumber:e,div:n}),s.sort(function(e,t){return e.pageNumber-t.pageNumber}),i(this.panel);for(const r of s)this.panel.append(r.div)}},cleanup(){s=[],i(this.panel)}}}(),PDFBug=function(){const d=[];let o=null;return{tools:[FontInspector,StepperManager,Stats],enable(n){var e=1===n.length&&"all"===n[0];const a=this.tools;for(const t of a)(e||n.includes(t.id))&&(t.enabled=!0);e||a.sort(function(e,t){e=(e=n.indexOf(e.id))<0?a.length:e,t=n.indexOf(t.id);return e-(t<0?a.length:t)})},init(e,t,n){this.loadCSS(),this.enable(n);var n=document.createElement("div"),a=(n.id="PDFBug",document.createElement("div")),o=(a.setAttribute("class","controls"),n.append(a),document.createElement("div"));o.setAttribute("class","panels"),n.append(o),t.append(n),t.style.right="300px";for(const i of this.tools){var r=document.createElement("div"),s=document.createElement("button");s.textContent=i.name,s.addEventListener("click",e=>{e.preventDefault(),this.selectPanel(i)}),a.append(s),o.append(r),i.panel=r,i.manager=this,i.enabled?i.init(e):r.textContent=`${i.name} is disabled. To enable add "${i.id}" to `+"the pdfBug parameter and refresh (separate multiple by commas).",d.push(s)}this.selectPanel(0)},loadCSS(){var e=import.meta["url"],t=document.createElement("link");t.rel="stylesheet",t.href=e.replace(/.js$/,".css"),document.head.append(t)},cleanup(){for(const e of this.tools)e.enabled&&e.cleanup()},selectPanel(e){if((e="number"!=typeof e?this.tools.indexOf(e):e)!==o){o=e;for(var[t,n]of this.tools.entries()){var a=t===e;d[t].classList.toggle("active",a),n.active=a,n.panel.hidden=!a}}}}}();globalThis.FontInspector=FontInspector,globalThis.StepperManager=StepperManager,globalThis.Stats=Stats;export{PDFBug};