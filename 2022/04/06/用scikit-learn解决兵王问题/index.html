<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/Northfourta.jpg"><link rel="icon" href="/img/Northfourta.jpg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Northfourta"><meta name="keywords" content="love life, love myself"><meta name="description" content="最近在看机器学习的经典教材《Hands On Machine Learning with Scikit-Learn、Keras and Tensorflow》，其中大量篇幅涉及到 scikit-learn 库。就上手学了学，为了避免自己成为行动上的矮子，想着把它用起来。恰好前几天刚刚用 LibSVM 复现了兵王问题，不如这次就再用 scikit-learn 再复现一次。好吧，其实就是我懒。唉，尽学"><meta property="og:type" content="article"><meta property="og:title" content="用 scikit-learn 解决兵王问题"><meta property="og:url" content="https://northfourta.github.io/2022/04/06/%E7%94%A8scikit-learn%E8%A7%A3%E5%86%B3%E5%85%B5%E7%8E%8B%E9%97%AE%E9%A2%98/index.html"><meta property="og:site_name" content="Northfourta&#39;s Blog"><meta property="og:description" content="最近在看机器学习的经典教材《Hands On Machine Learning with Scikit-Learn、Keras and Tensorflow》，其中大量篇幅涉及到 scikit-learn 库。就上手学了学，为了避免自己成为行动上的矮子，想着把它用起来。恰好前几天刚刚用 LibSVM 复现了兵王问题，不如这次就再用 scikit-learn 再复现一次。好吧，其实就是我懒。唉，尽学"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2022-04-06T05:45:21.000Z"><meta property="article:modified_time" content="2023-12-20T13:16:41.933Z"><meta property="article:author" content="Northfourta"><meta property="article:tag" content="SVM"><meta property="article:tag" content="机器学习"><meta property="article:tag" content="Python"><meta property="article:tag" content="scikit-learn"><meta name="twitter:card" content="summary_large_image"><title>用 scikit-learn 解决兵王问题 - Northfourta&#39;s Blog</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/mac.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"northfourta.github.io",root:"/",version:"1.8.14",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Northfourta</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于我</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/colorfulTree.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="用 scikit-learn 解决兵王问题"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-04-06 13:45" pubdate>2022年4月6日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 12k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 100 分钟</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">用 scikit-learn 解决兵王问题</h1><p class="note note-info">本文最后更新于：2023年12月20日 晚上</p><div class="markdown-body"><p>最近在看机器学习的经典教材《Hands On Machine Learning with Scikit-Learn、Keras and Tensorflow》，其中大量篇幅涉及到 scikit-learn 库。就上手学了学，为了避免自己成为行动上的矮子，想着把它用起来。恰好前几天刚刚用 LibSVM 复现了兵王问题，不如这次就再用 scikit-learn 再复现一次。好吧，其实就是我懒。唉，尽学卡普空炒冷饭了！</p><span id="more"></span><p>首先可以确定兵王问题是一个分类问题。显然，我们要采用监督式学习，那就依旧采用 SVM 算法吧。既然是炒冷饭，那就炒到底！！！确定了基本框架之后，就可以开始写代码了。思路与上一次基本相同，除使用库不同外，另外一个区别就是在测试集的生成方面采用了分层抽样的思想。</p><h1 id="一、加载数据"><a href="#一、加载数据" class="headerlink" title="一、加载数据"></a>一、加载数据</h1><p>老样子，先加载数据看看里子是啥样，知己知彼才能事半功倍</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br>data = pd.read_csv(<span class="hljs-string">&#x27;krkopt.data&#x27;</span>, names=[<span class="hljs-string">&#x27;x1&#x27;</span>,<span class="hljs-string">&#x27;y1&#x27;</span>,<span class="hljs-string">&#x27;x2&#x27;</span>,<span class="hljs-string">&#x27;y2&#x27;</span>,<span class="hljs-string">&#x27;x3&#x27;</span>,<span class="hljs-string">&#x27;y3&#x27;</span>,<span class="hljs-string">&#x27;result&#x27;</span>])<br>data.head() <span class="hljs-comment"># 查看数据集的前五条</span><br></code></pre></td></tr></table></figure><p><strong>Out [1]:</strong></p><table border="1" class="dataframe"><thead><tr style="text-align:center"><th></th><th>x1</th><th>y1</th><th>x2</th><th>y2</th><th>x3</th><th>y3</th><th>result</th></tr></thead><tbody><tr style="text-align:center"><th>0</th><td>a</td><td>1</td><td>b</td><td>3</td><td>c</td><td>2</td><td>draw</td></tr><tr style="text-align:center"><th>1</th><td>a</td><td>1</td><td>c</td><td>1</td><td>c</td><td>2</td><td>draw</td></tr><tr style="text-align:center"><th>2</th><td>a</td><td>1</td><td>c</td><td>1</td><td>d</td><td>1</td><td>draw</td></tr><tr style="text-align:center"><th>3</th><td>a</td><td>1</td><td>c</td><td>1</td><td>d</td><td>2</td><td>draw</td></tr><tr style="text-align:center"><th>4</th><td>a</td><td>1</td><td>c</td><td>2</td><td>c</td><td>1</td><td>draw</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">data.info() <span class="hljs-comment"># 查看数据集的基本概况</span><br></code></pre></td></tr></table></figure><p><strong>Out [2]:</strong></p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;pandas.core.frame.DataFrame&#x27;</span>&gt;<br>Range<span class="hljs-keyword">Index</span>: <span class="hljs-number">28056</span> entries, <span class="hljs-number">0</span> <span class="hljs-keyword">to</span> <span class="hljs-number">28055</span><br>Data <span class="hljs-keyword">columns</span> (total <span class="hljs-number">7</span> <span class="hljs-keyword">columns</span>):<br> #   <span class="hljs-keyword">Column</span>  Non-<span class="hljs-keyword">Null</span> Count  Dtype <br><span class="hljs-comment">---  ------  --------------  ----- </span><br> <span class="hljs-number">0</span>   x1      <span class="hljs-number">28056</span> non-<span class="hljs-keyword">null</span>  <span class="hljs-keyword">object</span><br> <span class="hljs-number">1</span>   y1      <span class="hljs-number">28056</span> non-<span class="hljs-keyword">null</span>  int64 <br> <span class="hljs-number">2</span>   x2      <span class="hljs-number">28056</span> non-<span class="hljs-keyword">null</span>  <span class="hljs-keyword">object</span><br> <span class="hljs-number">3</span>   y2      <span class="hljs-number">28056</span> non-<span class="hljs-keyword">null</span>  int64 <br> <span class="hljs-number">4</span>   x3      <span class="hljs-number">28056</span> non-<span class="hljs-keyword">null</span>  <span class="hljs-keyword">object</span><br> <span class="hljs-number">5</span>   y3      <span class="hljs-number">28056</span> non-<span class="hljs-keyword">null</span>  int64 <br> <span class="hljs-number">6</span>   result  <span class="hljs-number">28056</span> non-<span class="hljs-keyword">null</span>  <span class="hljs-keyword">object</span><br>dtypes: int64(<span class="hljs-number">3</span>), <span class="hljs-keyword">object</span>(<span class="hljs-number">4</span>)<br>memory <span class="hljs-keyword">usage</span>: <span class="hljs-number">1.5</span>+ MB<br></code></pre></td></tr></table></figure><p>这里我们可以看到这个数据集中共有28056个实例，其中’x1’，’x2’，’x3’，’result’属性是文本格式，其他属性都是数值类型。后面肯定要对这部分文本类型的属性进行处理，下面我们再来看看这些属性中的具体内容</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">col_text_index = [<span class="hljs-string">&#x27;x1&#x27;</span>,<span class="hljs-string">&#x27;x2&#x27;</span>,<span class="hljs-string">&#x27;x3&#x27;</span>,<span class="hljs-string">&#x27;result&#x27;</span>] <span class="hljs-comment"># 将文本类型的属性提取出来</span><br><span class="hljs-keyword">for</span> col_ <span class="hljs-keyword">in</span> col_text_index:<br>    <span class="hljs-built_in">print</span>(data[col_].value_counts(),<span class="hljs-string">&#x27;\n---------------&#x27;</span>)<br></code></pre></td></tr></table></figure><p><strong>Out [3]:</strong></p><pre><code class="hljs">d    12136
c     8726
b     5316
a     1878
Name: x1, dtype: int64 
---------------
h    3616
g    3599
f    3582
e    3576
a    3468
b    3438
c    3409
d    3368
Name: x2, dtype: int64 
---------------
h    4848
g    4600
f    4352
e    3450
a    2920
d    2796
b    2700
c    2390
Name: x3, dtype: int64 
---------------
fourteen    4553
thirteen    4194
twelve      3597
eleven      2854
draw        2796
fifteen     2166
ten         1985
nine        1712
eight       1433
seven        683
six          592
five         471
sixteen      390
two          246
four         198
three         81
one           78
zero          27
Name: result, dtype: int64 
---------------
</code></pre><p>实际上该数据集各个属性的值都是离散的，每个值都代表该属性中的一种情况，数值的大小在这里其实是没有太大意义的</p><h1 id="二、数据清洗"><a href="#二、数据清洗" class="headerlink" title="二、数据清洗"></a>二、数据清洗</h1><p>依旧按照惯例，对数据集中的文本属性进行数据清洗处理，这里使用 $sklearn.preprocessing.OrdinalEncoder $ 将分类属性中的文本处理为整数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> OrdinalEncoder<br>enc = OrdinalEncoder()<br>X = data.drop(<span class="hljs-string">&#x27;result&#x27;</span>, axis=<span class="hljs-number">1</span>)<br>X_tr = enc.fit_transform(X)<br>data_tr = pd.DataFrame(X_tr, columns=X.columns, index=X.index) + <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> attr <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;x1&#x27;</span>,<span class="hljs-string">&#x27;x2&#x27;</span>,<span class="hljs-string">&#x27;x3&#x27;</span>]:<br>    <span class="hljs-built_in">print</span>(data_tr[attr].value_counts(),<span class="hljs-string">&#x27;\n---------------&#x27;</span>)<br></code></pre></td></tr></table></figure><p><strong>Out [4]:</strong></p><pre><code class="hljs">4.0    12136
3.0     8726
2.0     5316
1.0     1878
Name: x1, dtype: int64 
---------------
8.0    3616
7.0    3599
6.0    3582
5.0    3576
1.0    3468
2.0    3438
3.0    3409
4.0    3368
Name: x2, dtype: int64 
---------------
8.0    4848
7.0    4600
6.0    4352
5.0    3450
1.0    2920
4.0    2796
2.0    2700
3.0    2390
Name: x3, dtype: int64 
---------------
</code></pre><p>这里，顺便将标签也处理一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">label = data[<span class="hljs-string">&#x27;result&#x27;</span>].copy()<br>label[label!=<span class="hljs-string">&#x27;draw&#x27;</span>] = -<span class="hljs-number">1</span><br>label.replace(<span class="hljs-string">&#x27;draw&#x27;</span>, <span class="hljs-number">1</span>, inplace=<span class="hljs-literal">True</span>)<br>label.columns = <span class="hljs-string">&#x27;result&#x27;</span><br></code></pre></td></tr></table></figure><p>这样数据清洗就完毕了，来看看数据的最终效果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">data_tr.head()<br></code></pre></td></tr></table></figure><p><strong>Out [5]:</strong></p><table border="1" class="dataframe"><thead><tr style="text-align:center"><th></th><th>x1</th><th>y1</th><th>x2</th><th>y2</th><th>x3</th><th>y3</th></tr></thead><tbody><tr style="text-align:center"><th>0</th><td>1.0</td><td>1.0</td><td>2.0</td><td>3.0</td><td>3.0</td><td>2.0</td></tr><tr style="text-align:center"><th>1</th><td>1.0</td><td>1.0</td><td>3.0</td><td>1.0</td><td>3.0</td><td>2.0</td></tr><tr style="text-align:center"><th>2</th><td>1.0</td><td>1.0</td><td>3.0</td><td>1.0</td><td>4.0</td><td>1.0</td></tr><tr style="text-align:center"><th>3</th><td>1.0</td><td>1.0</td><td>3.0</td><td>1.0</td><td>4.0</td><td>2.0</td></tr><tr style="text-align:center"><th>4</th><td>1.0</td><td>1.0</td><td>3.0</td><td>2.0</td><td>3.0</td><td>1.0</td></tr></tbody></table><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">label.head()<br></code></pre></td></tr></table></figure><p><strong>Out [6]:</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0</span>    <span class="hljs-number">1</span><br><span class="hljs-attribute">1</span>    <span class="hljs-number">1</span><br><span class="hljs-attribute">2</span>    <span class="hljs-number">1</span><br><span class="hljs-attribute">3</span>    <span class="hljs-number">1</span><br><span class="hljs-attribute">4</span>    <span class="hljs-number">1</span><br><span class="hljs-attribute">Name</span>: result, dtype: int64<br></code></pre></td></tr></table></figure><h1 id="三、创建测试集"><a href="#三、创建测试集" class="headerlink" title="三、创建测试集"></a>三、创建测试集</h1><p>在进一步处理数据之前，我们需要先生成测试集。接下来，我们将只会用到训练集，测试集只有在最后的模型测试时才会用到。通常来说，测试集取全部数据集的20%即可。这里调用 $sklearn.model_selection.StratifiedShuffleSplit$ 以分层抽样的形式进行数据集划分</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> StratifiedShuffleSplit<br>y_tr = label.to_numpy()<br>ss = StratifiedShuffleSplit(n_splits=<span class="hljs-number">1</span>, test_size=<span class="hljs-number">0.2</span>, random_state=<span class="hljs-number">42</span>)<br><span class="hljs-keyword">for</span> train_index, test_index <span class="hljs-keyword">in</span> ss.split(X_tr, y_tr):<br>    X_trainpre, X_testpre = X_tr[train_index], X_tr[test_index]<br>    y_train, y_test = y_tr[train_index], y_tr[test_index]<br>pd.DataFrame(y_train).value_counts()<br></code></pre></td></tr></table></figure><p><strong>Out [7]:</strong></p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-literal">-</span>1    20207<br> 1     2237<br><span class="hljs-attribute">dtype</span>: int64<br></code></pre></td></tr></table></figure><h1 id="四、特征缩放"><a href="#四、特征缩放" class="headerlink" title="四、特征缩放"></a>四、特征缩放</h1><p>特征缩放是数据预处理中重要的环节之一，如果输入的数值属性有非常大的比例差异，往往会导致机器学习算法的性能表现不佳。同比例缩放所有属性的两种常用方法是最小-最大缩放和标准化。其中，标准化方法受到异常值的影响更小，这里尝试使用标准化方法。scikit-learn库中对应的类是 $sklearn.preprocessing.StandardScaler$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler<br>scaler = StandardScaler()<br>X_train = scaler.fit_transform(X_trainpre)<br>X_test = scaler.transform(X_testpre)<br>pd.DataFrame(X_test, columns=data_tr.columns).head()<br></code></pre></td></tr></table></figure><p><strong>Out [8]:</strong></p><table border="1" class="dataframe"><thead><tr style="text-align:center"><th></th><th>x1</th><th>y1</th><th>x2</th><th>y2</th><th>x3</th><th>y3</th></tr></thead><tbody><tr style="text-align:center"><th>0</th><td>0.947896</td><td>1.235042</td><td>-0.239276</td><td>-0.226981</td><td>0.415659</td><td>-1.532498</td></tr><tr style="text-align:center"><th>1</th><td>-0.119730</td><td>-0.923108</td><td>0.195286</td><td>1.088712</td><td>-1.748052</td><td>-0.202882</td></tr><tr style="text-align:center"><th>2</th><td>-0.119730</td><td>0.155967</td><td>-0.239276</td><td>1.088712</td><td>-1.748052</td><td>-0.646088</td></tr><tr style="text-align:center"><th>3</th><td>-2.254982</td><td>-0.923108</td><td>-1.108400</td><td>1.088712</td><td>-0.017083</td><td>-1.089293</td></tr><tr style="text-align:center"><th>4</th><td>-1.187356</td><td>-0.923108</td><td>0.195286</td><td>0.211583</td><td>-1.315310</td><td>1.126734</td></tr></tbody></table><h1 id="五、模型选择"><a href="#五、模型选择" class="headerlink" title="五、模型选择"></a>五、模型选择</h1><p>我们选择 RBF 内核的支持向量机，有两个超参数 $C$，$\gamma$ 进行确定。LibSVM 的帮助文档中建议 $C\in [2^{-5}, 2^{15}]$，$\gamma\in[2^{-15},2^{3}]$。这里我们遵循文档规定，在此范围内进行粗略搜索；同时这里采用五折交叉验证方法对超参数的优劣进行判断</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearnex <span class="hljs-keyword">import</span> patch_sklearn<br>patch_sklearn()<br><br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> GridSearchCV<br><span class="hljs-keyword">from</span> sklearn.svm <span class="hljs-keyword">import</span> SVC<br>C_range = np.logspace(-<span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>, base=<span class="hljs-number">2</span>)<br>gamma_range = np.logspace(-<span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">10</span>, base=<span class="hljs-number">2</span>)<br>param_grid = <span class="hljs-built_in">dict</span>(gamma=gamma_range, C=C_range)<br>cv = StratifiedShuffleSplit(n_splits=<span class="hljs-number">5</span>, test_size=<span class="hljs-number">0.2</span>, random_state=<span class="hljs-number">42</span>)<br>grid = GridSearchCV(SVC(kernel=<span class="hljs-string">&#x27;rbf&#x27;</span>), param_grid=param_grid, cv=cv, verbose=<span class="hljs-number">3</span>, scoring=<span class="hljs-string">&#x27;accuracy&#x27;</span>)<br>grid.fit(X_train, y_train)<br><span class="hljs-built_in">print</span>(<br>    <span class="hljs-string">&quot;The best parameters are %s with a score of %0.4f&quot;</span><br>    % (grid.best_params_, grid.best_score_)<br>)<br></code></pre></td></tr></table></figure><p><strong>Out [9]:</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Fitting 5 folds <span class="hljs-keyword">for</span> each of 110 candidates, totalling 550 fits<br>[CV 1/5] END .<span class="hljs-attribute">C</span>=0.03125, <span class="hljs-attribute">gamma</span>=3.0517578125e-05;, <span class="hljs-attribute">score</span>=0.900 total time=   0.4s<br>[CV 2/5] END .<span class="hljs-attribute">C</span>=0.03125, <span class="hljs-attribute">gamma</span>=3.0517578125e-05;, <span class="hljs-attribute">score</span>=0.900 total time=   0.2s<br>[CV 3/5] END .<span class="hljs-attribute">C</span>=0.03125, <span class="hljs-attribute">gamma</span>=3.0517578125e-05;, <span class="hljs-attribute">score</span>=0.900 total time=   0.2s<br>[CV 4/5] END .<span class="hljs-attribute">C</span>=0.03125, <span class="hljs-attribute">gamma</span>=3.0517578125e-05;, <span class="hljs-attribute">score</span>=0.900 total time=   0.2s<br>[CV 5/5] END .<span class="hljs-attribute">C</span>=0.03125, <span class="hljs-attribute">gamma</span>=3.0517578125e-05;, <span class="hljs-attribute">score</span>=0.900 total time=   0.2s<br>[CV 1/5] END <span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=0.03125, <span class="hljs-attribute">gamma</span>=0.0001220703125;, <span class="hljs-attribute">score</span>=0.900 total time=   0.2s<br>[CV 2/5] END <span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=0.03125, <span class="hljs-attribute">gamma</span>=0.0001220703125;, <span class="hljs-attribute">score</span>=0.900 total time=   0.2s<br>[CV 3/5] END <span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=0.03125, <span class="hljs-attribute">gamma</span>=0.0001220703125;, <span class="hljs-attribute">score</span>=0.900 total time=   0.2s<br>[CV 4/5] END <span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=0.03125, <span class="hljs-attribute">gamma</span>=0.0001220703125;, <span class="hljs-attribute">score</span>=0.900 total time=   0.2s<br><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<br>[CV 4/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=32768.0, <span class="hljs-attribute">gamma</span>=0.03125;, <span class="hljs-attribute">score</span>=0.996 total time=   6.9s<br>[CV 5/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=32768.0, <span class="hljs-attribute">gamma</span>=0.03125;, <span class="hljs-attribute">score</span>=0.997 total time=   7.6s<br>[CV 1/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=32768.0, <span class="hljs-attribute">gamma</span>=0.125;, <span class="hljs-attribute">score</span>=0.994 total time=   1.4s<br>[CV 2/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=32768.0, <span class="hljs-attribute">gamma</span>=0.125;, <span class="hljs-attribute">score</span>=0.996 total time=   1.2s<br>[CV 3/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=32768.0, <span class="hljs-attribute">gamma</span>=0.125;, <span class="hljs-attribute">score</span>=0.995 total time=   1.2s<br>[CV 4/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=32768.0, <span class="hljs-attribute">gamma</span>=0.125;, <span class="hljs-attribute">score</span>=0.996 total time=   1.3s<br>[CV 5/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=32768.0, <span class="hljs-attribute">gamma</span>=0.125;, <span class="hljs-attribute">score</span>=0.997 total time=   1.3s<br>[CV 1/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=32768.0, <span class="hljs-attribute">gamma</span>=0.5;, <span class="hljs-attribute">score</span>=0.999 total time=   0.3s<br>[CV 2/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-attribute">C</span>=32768.0, <span class="hljs-attribute">gamma</span>=0.5;, <span class="hljs-attribute">score</span>=0.997 total time=   0.3s<br>The best parameters are &#123;<span class="hljs-string">&#x27;C&#x27;</span>: 512.0, <span class="hljs-string">&#x27;gamma&#x27;</span>: 0.5&#125; with a score of 0.9976<br></code></pre></td></tr></table></figure><p>参数搜索完毕，最好的模型精度可以达到 <strong>99.76%</strong> ，似乎还不错！这就完了？当然没有，也许会存在更优的解，也不一定。花点时间做更进一步搜索也值得，我们可以在前面粗略搜索的最优参数附近作进一步的精细搜索。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 获取粗略搜索得到的最优参数</span><br>C_current_best = grid.best_params_[<span class="hljs-string">&#x27;C&#x27;</span>]<br>gamma_current_best = grid.best_params_[<span class="hljs-string">&#x27;gamma&#x27;</span>]<br>index_C = np.where(C_range == C_current_best)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>index_Gamma = np.where(gamma_range == gamma_current_best)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># 计算精细搜索的参数范围</span><br>n = <span class="hljs-number">10</span><br>CScale = np.linspace(-<span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>)<br>minCScale = (CScale[index_C] + CScale[<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, index_C-<span class="hljs-number">1</span>)]) * <span class="hljs-number">0.5</span><br>maxCScale = (CScale[index_C] + CScale[<span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(CScale), index_C+<span class="hljs-number">1</span>)]) * <span class="hljs-number">0.5</span><br>CRange_finer = np.logspace(minCScale, maxCScale, n+<span class="hljs-number">1</span>, base=<span class="hljs-number">2</span>)<br><br>GammaScale = np.linspace(-<span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">10</span>)<br>minGammaScale = (GammaScale[index_Gamma] + GammaScale[<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, index_Gamma-<span class="hljs-number">1</span>)]) * <span class="hljs-number">0.5</span><br>maxGammaScale = (GammaScale[index_Gamma] + GammaScale[<span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(GammaScale), index_Gamma+<span class="hljs-number">1</span>)]) * <span class="hljs-number">0.5</span><br>GammaRange_finer = np.logspace(minGammaScale, maxGammaScale, n+<span class="hljs-number">1</span>, base=<span class="hljs-number">2</span>)<br><br>param_grid = <span class="hljs-built_in">dict</span>(gamma=GammaRange_finer, C=CRange_finer)<br>cv = StratifiedShuffleSplit(n_splits=<span class="hljs-number">5</span>, test_size=<span class="hljs-number">0.2</span>, random_state=<span class="hljs-number">42</span>)<br>grid = GridSearchCV(SVC(kernel=<span class="hljs-string">&#x27;rbf&#x27;</span>), param_grid=param_grid, cv=cv, verbose=<span class="hljs-number">3</span>, scoring=<span class="hljs-string">&#x27;accuracy&#x27;</span>)<br>grid.fit(X_train, y_train)<br><span class="hljs-built_in">print</span>(<br>    <span class="hljs-string">&quot;The best parameters are %s with a score of %0.4f&quot;</span><br>    % (grid.best_params_, grid.best_score_)<br>)<br></code></pre></td></tr></table></figure><p><strong>Out [10]:</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Fitting 5 folds <span class="hljs-keyword">for</span> each of 121 candidates, totalling 605 fits<br>[CV 1/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<span class="hljs-attribute">C</span>=256.0, <span class="hljs-attribute">gamma</span>=0.25;, <span class="hljs-attribute">score</span>=0.998 total time=   0.4s<br>[CV 2/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<span class="hljs-attribute">C</span>=256.0, <span class="hljs-attribute">gamma</span>=0.25;, <span class="hljs-attribute">score</span>=0.997 total time=   0.4s<br>[CV 3/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<span class="hljs-attribute">C</span>=256.0, <span class="hljs-attribute">gamma</span>=0.25;, <span class="hljs-attribute">score</span>=0.997 total time=   0.4s<br>[CV 4/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<span class="hljs-attribute">C</span>=256.0, <span class="hljs-attribute">gamma</span>=0.25;, <span class="hljs-attribute">score</span>=0.996 total time=   0.3s<br>[CV 5/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<span class="hljs-attribute">C</span>=256.0, <span class="hljs-attribute">gamma</span>=0.25;, <span class="hljs-attribute">score</span>=0.996 total time=   0.4s<br><span class="hljs-built_in">..</span>.<br>[CV 1/5] END <span class="hljs-attribute">C</span>=1024.0, <span class="hljs-attribute">gamma</span>=0.8705505632961241;, <span class="hljs-attribute">score</span>=0.998 total time=   0.3s<br>[CV 2/5] END <span class="hljs-attribute">C</span>=1024.0, <span class="hljs-attribute">gamma</span>=0.8705505632961241;, <span class="hljs-attribute">score</span>=0.998 total time=   0.4s<br>[CV 3/5] END <span class="hljs-attribute">C</span>=1024.0, <span class="hljs-attribute">gamma</span>=0.8705505632961241;, <span class="hljs-attribute">score</span>=0.997 total time=   0.3s<br>[CV 4/5] END <span class="hljs-attribute">C</span>=1024.0, <span class="hljs-attribute">gamma</span>=0.8705505632961241;, <span class="hljs-attribute">score</span>=0.997 total time=   0.4s<br>[CV 5/5] END <span class="hljs-attribute">C</span>=1024.0, <span class="hljs-attribute">gamma</span>=0.8705505632961241;, <span class="hljs-attribute">score</span>=0.999 total time=   0.4s<br>[CV 1/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<span class="hljs-attribute">C</span>=1024.0, <span class="hljs-attribute">gamma</span>=1.0;, <span class="hljs-attribute">score</span>=0.998 total time=   0.3s<br>[CV 2/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<span class="hljs-attribute">C</span>=1024.0, <span class="hljs-attribute">gamma</span>=1.0;, <span class="hljs-attribute">score</span>=0.997 total time=   0.3s<br>[CV 3/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<span class="hljs-attribute">C</span>=1024.0, <span class="hljs-attribute">gamma</span>=1.0;, <span class="hljs-attribute">score</span>=0.997 total time=   0.3s<br>[CV 4/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<span class="hljs-attribute">C</span>=1024.0, <span class="hljs-attribute">gamma</span>=1.0;, <span class="hljs-attribute">score</span>=0.997 total time=   0.4s<br>[CV 5/5] END <span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span><span class="hljs-built_in">..</span>.<span class="hljs-attribute">C</span>=1024.0, <span class="hljs-attribute">gamma</span>=1.0;, <span class="hljs-attribute">score</span>=0.999 total time=   0.3s<br>The best parameters are &#123;<span class="hljs-string">&#x27;C&#x27;</span>: 256.0, <span class="hljs-string">&#x27;gamma&#x27;</span>: 0.7578582832551991&#125; with a score of 0.9977<br></code></pre></td></tr></table></figure><p>到这里，我们的参数搜索已经完成。剩下的就是创建 SVM 模型了，这步就很简单了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><br>model =SVC(kernel=<span class="hljs-string">&#x27;rbf&#x27;</span>, gamma=grid.best_params_[<span class="hljs-string">&#x27;gamma&#x27;</span>], C=grid.best_params_[<span class="hljs-string">&#x27;C&#x27;</span>])<br>model.fit(X_train, y_train)<br>pre = model.predict(X_test)<br>accuracy_score(y_test, pre)<br></code></pre></td></tr></table></figure><p><strong>Out [11]:</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">测试集准确率：0.998039914468995<br></code></pre></td></tr></table></figure><h1 id="六、代码展示"><a href="#六、代码展示" class="headerlink" title="六、代码展示"></a>六、代码展示</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">project: 用 scikit-learn 解决兵王问题</span><br><span class="hljs-string">author：Northfourta</span><br><span class="hljs-string">date：2022/04/06</span><br><span class="hljs-string">dependent libraries：</span><br><span class="hljs-string">- numpy</span><br><span class="hljs-string">- pandas</span><br><span class="hljs-string">- scikit-</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> OrdinalEncoder<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> StratifiedShuffleSplit<br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> GridSearchCV<br><span class="hljs-keyword">from</span> sklearn.svm <span class="hljs-keyword">import</span> SVC<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><span class="hljs-keyword">from</span> sklearnex <span class="hljs-keyword">import</span> patch_sklearn<br>patch_sklearn() <span class="hljs-comment"># scikit-learn 加速包</span><br><br><span class="hljs-comment"># 加载数据</span><br>data = pd.read_csv(<span class="hljs-string">&#x27;krkopt.data&#x27;</span>, names=[<span class="hljs-string">&#x27;x1&#x27;</span>,<span class="hljs-string">&#x27;y1&#x27;</span>,<span class="hljs-string">&#x27;x2&#x27;</span>,<span class="hljs-string">&#x27;y2&#x27;</span>,<span class="hljs-string">&#x27;x3&#x27;</span>,<span class="hljs-string">&#x27;y3&#x27;</span>,<span class="hljs-string">&#x27;result&#x27;</span>])<br><span class="hljs-comment"># 数据清洗</span><br>enc = OrdinalEncoder()<br>X = data.drop(<span class="hljs-string">&#x27;result&#x27;</span>, axis=<span class="hljs-number">1</span>)<br>X_tr = enc.fit_transform(X)<br><br>label = data[<span class="hljs-string">&#x27;result&#x27;</span>].copy()<br>label[label!=<span class="hljs-string">&#x27;draw&#x27;</span>] = -<span class="hljs-number">1</span><br>label.replace(<span class="hljs-string">&#x27;draw&#x27;</span>, <span class="hljs-number">1</span>, inplace=<span class="hljs-literal">True</span>)<br><span class="hljs-comment"># 创建测试集</span><br>y_tr = label.to_numpy()<br>ss = StratifiedShuffleSplit(n_splits=<span class="hljs-number">1</span>, test_size=<span class="hljs-number">0.2</span>, random_state=<span class="hljs-number">42</span>)<br><span class="hljs-keyword">for</span> train_index, test_index <span class="hljs-keyword">in</span> ss.split(X_tr, y_tr):<br>    X_trainpre, X_testpre = X_tr[train_index], X_tr[test_index]<br>    y_train, y_test = y_tr[train_index], y_tr[test_index]<br>    <br><span class="hljs-comment"># 特征缩放</span><br>scaler = StandardScaler()<br>X_train = scaler.fit_transform(X_trainpre)<br>X_test = scaler.transform(X_testpre)<br><br><span class="hljs-comment"># 模型选择</span><br>C_range = np.logspace(-<span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>, base=<span class="hljs-number">2</span>)<br>gamma_range = np.logspace(-<span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">10</span>, base=<span class="hljs-number">2</span>)<br>param_grid = <span class="hljs-built_in">dict</span>(gamma=gamma_range, C=C_range)<br>cv = StratifiedShuffleSplit(n_splits=<span class="hljs-number">5</span>, test_size=<span class="hljs-number">0.2</span>, random_state=<span class="hljs-number">42</span>)<br>grid = GridSearchCV(SVC(kernel=<span class="hljs-string">&#x27;rbf&#x27;</span>), param_grid=param_grid, cv=cv, verbose=<span class="hljs-number">3</span>, scoring=<span class="hljs-string">&#x27;accuracy&#x27;</span>)<br>grid.fit(X_train, y_train)<br><span class="hljs-built_in">print</span>(<br>    <span class="hljs-string">&quot;The best parameters are %s with a score of %0.4f&quot;</span><br>    % (grid.best_params_, grid.best_score_)<br>)<br><br><span class="hljs-comment"># 获取粗略搜索得到的最优参数</span><br>C_current_best = grid.best_params_[<span class="hljs-string">&#x27;C&#x27;</span>]<br>gamma_current_best = grid.best_params_[<span class="hljs-string">&#x27;gamma&#x27;</span>]<br>index_C = np.where(C_range == C_current_best)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>index_Gamma = np.where(gamma_range == gamma_current_best)[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># 计算精细搜索的参数范围</span><br>n = <span class="hljs-number">10</span><br>CScale = np.linspace(-<span class="hljs-number">5</span>, <span class="hljs-number">15</span>, <span class="hljs-number">11</span>)<br>minCScale = (CScale[index_C] + CScale[<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, index_C-<span class="hljs-number">1</span>)]) * <span class="hljs-number">0.5</span><br>maxCScale = (CScale[index_C] + CScale[<span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(CScale), index_C+<span class="hljs-number">1</span>)]) * <span class="hljs-number">0.5</span><br>CRange_finer = np.logspace(minCScale, maxCScale, n+<span class="hljs-number">1</span>, base=<span class="hljs-number">2</span>)<br><br>GammaScale = np.linspace(-<span class="hljs-number">15</span>, <span class="hljs-number">3</span>, <span class="hljs-number">10</span>)<br>minGammaScale = (GammaScale[index_Gamma] + GammaScale[<span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, index_Gamma-<span class="hljs-number">1</span>)]) * <span class="hljs-number">0.5</span><br>maxGammaScale = (GammaScale[index_Gamma] + GammaScale[<span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(GammaScale), index_Gamma+<span class="hljs-number">1</span>)]) * <span class="hljs-number">0.5</span><br>GammaRange_finer = np.logspace(minGammaScale, maxGammaScale, n+<span class="hljs-number">1</span>, base=<span class="hljs-number">2</span>)<br><br>param_grid = <span class="hljs-built_in">dict</span>(gamma=GammaRange_finer, C=CRange_finer)<br>cv = StratifiedShuffleSplit(n_splits=<span class="hljs-number">5</span>, test_size=<span class="hljs-number">0.2</span>, random_state=<span class="hljs-number">42</span>)<br>grid = GridSearchCV(SVC(kernel=<span class="hljs-string">&#x27;rbf&#x27;</span>), param_grid=param_grid, cv=cv, verbose=<span class="hljs-number">3</span>, scoring=<span class="hljs-string">&#x27;accuracy&#x27;</span>)<br>grid.fit(X_train, y_train)<br><span class="hljs-built_in">print</span>(<br>    <span class="hljs-string">&quot;The best parameters are %s with a score of %0.4f&quot;</span><br>    % (grid.best_params_, grid.best_score_)<br>)<br><br><span class="hljs-comment"># 模型创建</span><br>model =SVC(kernel=<span class="hljs-string">&#x27;rbf&#x27;</span>, gamma=grid.best_params_[<span class="hljs-string">&#x27;gamma&#x27;</span>], C=grid.best_params_[<span class="hljs-string">&#x27;C&#x27;</span>])<br>model.fit(X_train, y_train)<br>pre = model.predict(X_test)<br>accuracy_score(y_test, pre)<br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="category-chain-item">学习笔记</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/SVM/">#SVM</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">#机器学习</a> <a href="/tags/Python/">#Python</a> <a href="/tags/scikit-learn/">#scikit-learn</a></div></div><div class="license-box my-3"><div class="license-title"><div>用 scikit-learn 解决兵王问题</div><div>https://northfourta.github.io/2022/04/06/%E7%94%A8scikit-learn%E8%A7%A3%E5%86%B3%E5%85%B5%E7%8E%8B%E9%97%AE%E9%A2%98/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Northfourta</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年4月6日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2022/05/19/Linux%E4%B8%8Bclion%E5%AE%89%E8%A3%85%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/" title="Linux下clion安装第三方库"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Linux下clion安装第三方库</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2022/03/22/%E5%9F%BA%E4%BA%8ELibSVM%E7%9A%84%E5%85%B5%E7%8E%8B%E9%97%AE%E9%A2%98%E5%AE%9E%E7%8E%B0/" title="基于LibSVM的兵王问题实现"><span class="hidden-mobile">基于LibSVM的兵王问题实现</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a><div style="color_dark:#c4c6c9">2021 - 2024</div><div style="color_dark:#c4c6c9">Northfourta的博客 | 记录成长的过程</div></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var o=jQuery("#board-ctn").offset().top;window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-o}),t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))</script><script>!function(){var e=CONFIG.code_language.enable&&CONFIG.code_language.default,a=CONFIG.copy_btn;if(e||a){var i="";i+='<div class="code-widget">',i+="LANG",i+="</div>",jQuery(".markdown-body pre").each((function(){var n=jQuery(this);if(!(n.find("code.mermaid").length>0||n.find("span.line").length>0)){var t,c="";e&&(c=CONFIG.code_language.default,n[0].children.length>0&&n[0].children[0].classList.length>=2&&n.children().hasClass("hljs")?c=n[0].children[0].classList[1]:n[0].getAttribute("data-language")?c=n[0].getAttribute("data-language"):n.parent().hasClass("sourceCode")&&n[0].children.length>0&&n[0].children[0].classList.length>=2?(c=n[0].children[0].classList[1],n.parent().addClass("code-wrapper")):n.parent().hasClass("markdown-body")&&0===n[0].classList.length&&n.wrap('<div class="code-wrapper"></div>'),c=c.toUpperCase().replace("NONE",CONFIG.code_language.default)),n.append(i.replace("LANG",c).replace('code-widget">',(t=n[0],(Fluid.utils.getBackgroundLightness(t)>=0?"code-widget-light":"code-widget-dark")+(a?' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>':' code-widget">')))),a&&Fluid.utils.createScript("https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js",(function(){new window.ClipboardJS(".copy-btn",{target:function(e){for(var a=e.parentNode.childNodes,i=0;i<a.length;i++)if("CODE"===a[i].tagName)return a[i]}}).on("success",(function(e){e.clearSelection(),e.trigger.innerHTML=e.trigger.innerHTML.replace("icon-copy","icon-success"),setTimeout((function(){e.trigger.innerHTML=e.trigger.innerHTML.replace("icon-success","icon-copy")}),2e3)}))}))}}))}}()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var o=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),n=[];for(var i of o)n.push(".markdown-body > "+i.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(n.join(", "))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script>MathJax={tex:{inlineMath:{"[+]":[["$","$"]]}},loader:{load:["ui/lazy"]},options:{renderActions:{findScript:[10,e=>{document.querySelectorAll('script[type^="math/tex"]').forEach(t=>{const a=!!t.type.match(/; *mode=display/),n=new e.options.MathItem(t.textContent,e.inputJax[0],a),o=document.createTextNode("");t.parentNode.replaceChild(o,t),n.start={node:o,delim:"",n:0},n.end={node:o,delim:"",n:0},e.math.push(n)})},"",!1],insertedScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(e=>{let t=e.parentNode;"li"===t.nodeName.toLowerCase()&&t.parentNode.classList.add("has-jax")})},"",!1]}}}</script><script src="https://lib.baomitu.com/mathjax/3.2.0/es5/tex-mml-chtml.js"></script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>